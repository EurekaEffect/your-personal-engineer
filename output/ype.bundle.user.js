// ==UserScript==
// @name            Your Personal Engineer
// @description     Makes your trading routine more comfortable.
// @author          https://steamcommunity.com/id/EurekaEffect/
// @version         1.0

// @updateURL       https://github.com/EurekaEffect/your-personal-engineer/raw/refs/heads/master/output/ype.bundle.user.js
// @downloadURL     https://github.com/EurekaEffect/your-personal-engineer/raw/refs/heads/master/output/ype.bundle.user.js

// @match           *://backpack.tf/stats/*
// @match           *://backpack.tf/classifieds*
// @match           *://steamcommunity.com/tradeoffer/new*

// @run-at          document-idle
// ==/UserScript==
(()=>{"use strict";var e={279:function(e,t,r){var n=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(o,a){function i(e){try{d(n.next(e))}catch(e){a(e)}}function s(e){try{d(n.throw(e))}catch(e){a(e)}}function d(e){var t;e.done?o(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(i,s)}d((n=n.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.throwError=function(e){throw alert(`Script: Your Personal Engineer\nMessage: ${e}`),Error(e)},t.window=a;const o=r(366);function a(){return unsafeWindow}!function(){n(this,void 0,void 0,(function*(){if((0,o.isTradeOfferUrl)(location.href)){const e=new URLSearchParams(location.search).get("ype.asset_id");if(!e)return;a().UserThem.loadInventory(440,2);const t=a().UserThem.OnLoadInventoryComplete;a().UserThem.OnLoadInventoryComplete=function(r,n,i){a().UserThem.OnLoadInventoryComplete=t,a().UserThem.OnLoadInventoryComplete(r,n,i);const s=a().UserThem.getInventory(440,2);s.Initialize(),s.MakeActive(),a().g_ActiveInventory=s,a().g_ActiveInventory.hide(),a().SelectInventoryFromUser(a().UserYou,440,2,!1),(0,o.SetItemInTrade)(e)}}}))}()},366:(e,t,r)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.SetItemsInTrade=function(e){const t=(0,n.window)().CTradeOfferStateManager,r=t.UpdateTradeStatus;t.UpdateTradeStatus=function(){};for(let r of e){const e=document.querySelector(`#item440_2_${r}`);if(e){const o=e.rgItem;(0,n.window)().BIsInTradeSlot(o)?(0,n.throwError)(`Item with id '${r}' is already in a trade slot.`):t.SetItemInTrade(o,0,1)}else(0,n.throwError)(`Item with id '${r}' not found.`)}t.UpdateTradeStatus=r,t.UpdateTradeStatus()},t.SetItemInTrade=function(e){const t=document.querySelector(`#item440_2_${e}`);if(t){const r=t.rgItem;(0,n.window)().BIsInTradeSlot(r)?(0,n.throwError)(`Item with id '${e}' is already in a trade slot.`):(0,n.window)().CTradeOfferStateManager.SetItemInTrade(r,0,1)}else(0,n.throwError)(`Item with id '${e}' not found.`)},t.removeItemFromTradeOffer=function(e){},t.refreshTradeStatus=function(){(0,n.window)().RefreshTradeStatus((0,n.window)().g_rgCurrentTradeStatus)},t.isTradeOfferUrl=function(e){return/^https:\/\/steamcommunity\.com\/tradeoffer\/new\/\?partner=\d+&token=.+$/.test(e)};const n=r(279)}},t={};!function r(n){var o=t[n];if(void 0!==o)return o.exports;var a=t[n]={exports:{}};return e[n].call(a.exports,a,a.exports,r),a.exports}(279)})();