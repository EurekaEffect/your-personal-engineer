// ==UserScript==
// @name            Your Personal Engineer
// @description     Makes your trading routine more comfortable.
// @author          https://steamcommunity.com/id/EurekaEffect/
// @version         1.0

// @updateURL       https://github.com/EurekaEffect/your-personal-engineer/raw/refs/heads/master/output/ype.bundle.user.js
// @downloadURL     https://github.com/EurekaEffect/your-personal-engineer/raw/refs/heads/master/output/ype.bundle.user.js

// @match           *://backpack.tf/stats/*
// @match           *://backpack.tf/classifieds*
// @match           *://steamcommunity.com/tradeoffer/new*

// @run-at          document-start
// ==/UserScript==
(()=>{"use strict";var e={47:function(e,t){var n=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function d(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.executeConsoleScript=function(e){return n(this,void 0,void 0,(function*(){return yield new Promise((t=>{let o=document.createElement("button");o.addEventListener("click",(()=>n(this,void 0,void 0,(function*(){yield e(),document.body.contains(o)&&o.remove(),t(!0)})))),new MutationObserver(((e,t)=>{for(let n of e)"childList"===n.type&&document.body.contains(o)&&(o.click(),t.disconnect())})).observe(document.body,{childList:!0}),document.body.append(o)}))}))},t.waitForElementToBeAdded=function(e){return n(this,void 0,void 0,(function*(){return yield new Promise((t=>{new MutationObserver(((n,o)=>{for(let r of n)if("childList"===r.type){const n=document.querySelector(`${e}`);n&&(o.disconnect(),t(n))}})).observe(document,{childList:!0,subtree:!0});const n=document.querySelector(`${e}`);n&&t(n)}))}))},t.waitForChanges=function(e){return n(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{const o=document.querySelector(e);o?new MutationObserver(((e,n)=>{for(let r of e)"childList"===r.type&&r.addedNodes.length>0&&(n.disconnect(),t(o))})).observe(o,{childList:!0,subtree:!0}):n(new Error(`Element with id ${e} not found`))}))}))},t.awaitDocumentReady=function(){return new Promise((e=>{"loading"!==document.readyState?e():document.addEventListener("DOMContentLoaded",(()=>e()))}))}},279:function(e,t,n){var o=this&&this.__awaiter||function(e,t,n,o){return new(n||(n=Promise))((function(r,i){function d(e){try{c(o.next(e))}catch(e){i(e)}}function s(e){try{c(o.throw(e))}catch(e){i(e)}}function c(e){var t;e.done?r(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(d,s)}c((o=o.apply(e,t||[])).next())}))};Object.defineProperty(t,"__esModule",{value:!0}),t.throwError=function(e){throw alert(`Script: Your Personal Engineer\nMessage: ${e}`),Error(e)},t.getWindow=d;const r=n(366),i=n(47);function d(){return unsafeWindow}!function(){o(this,void 0,void 0,(function*(){if(yield(0,i.awaitDocumentReady)(),(0,r.isTradeOfferUrl)(location.href)){const e=new URLSearchParams(location.search).get("ype.asset_id");if(!e)return;setTimeout((()=>o(this,void 0,void 0,(function*(){function t(){return o(this,void 0,void 0,(function*(){const e=UserYou.getInventory(440,2);e.Initialize(),e.MakeActive()}))}function n(){return o(this,void 0,void 0,(function*(){const e=UserThem.getInventory(440,2),t=e.elInventory;e.Initialize(),e.MakeActive(),t.style.display="none"}))}(0,i.executeConsoleScript)(n).then((()=>o(this,void 0,void 0,(function*(){const t=`#inventory_${d().UserThem.GetSteamId()}_440_2`;yield(0,i.waitForElementToBeAdded)(t),(0,i.waitForChanges)(t).then((()=>{(0,r.addItemToTradeOffer)(e),(0,r.refreshTradeStatus)()})),yield(0,i.executeConsoleScript)(n),console.log("their")})))),(0,i.executeConsoleScript)(t).then((()=>o(this,void 0,void 0,(function*(){const e=`#inventory_${d().UserYou.GetSteamId()}_440_2`;yield(0,i.waitForElementToBeAdded)(e),yield(0,i.executeConsoleScript)(t),console.log("your")}))))}))),1)}}))}()},366:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addItemToTradeOffer=function(e){const t=(0,o.getWindow)().g_rgCurrentTradeStatus.me.assets,n=(0,o.getWindow)().g_rgCurrentTradeStatus.them.assets,r=document.querySelector(`#item440_2_${e}`);if(r){const i=r.rgItem.is_their_item?n:t;i.find((t=>t.assetid===e))?(0,o.throwError)(`Item with asset_id '${e}' is already in a trade offer.`):(i.push({appid:440,contextid:"2",amount:1,assetid:e}),(0,o.getWindow)().GTradeStateManager.m_bChangesMade=!0,(0,o.getWindow)().g_rgCurrentTradeStatus.version++)}else(0,o.throwError)(`Item with asset_id '${e}' was not found.`)},t.removeItemFromTradeOffer=function(e){},t.refreshTradeStatus=function(){(0,o.getWindow)().RefreshTradeStatus((0,o.getWindow)().g_rgCurrentTradeStatus)},t.isTradeOfferUrl=function(e){return/^https:\/\/steamcommunity\.com\/tradeoffer\/new\/\?partner=\d+&token=.+$/.test(e)};const o=n(279)}},t={};!function n(o){var r=t[o];if(void 0!==r)return r.exports;var i=t[o]={exports:{}};return e[o].call(i.exports,i,i.exports,n),i.exports}(279)})();